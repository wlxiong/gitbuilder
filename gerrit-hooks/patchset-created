#!/usr/bin/env python
import os
import sys
import getopt
import subprocess

# patchset-created
# --change <change id>
# --is-draft <boolean>
# --change-url <change url>
# --project <project name>
# --branch <branch>
# --topic <topic>
# --uploader <uploader>
# --commit <sha1>
# --patchset <patchset id>


def main():
    try:
        opts, args = getopt.getopt(sys.argv[1:], "",
                                   ["change=", "is-draft=", "change-url=", "project=",
                                    "branch=", "topic=", "uploader=", "commit=", "patchset="])
    except getopt.GetoptError, err:
        print >> sys.stderr, str(err)
        sys.exit(2)

    project = None
    commit = None

    for o, a in opts:
        if o == '--project':
            project = a
        elif o == '--commit':
            commit = a
        elif o == '--branch':
            branch = a
    print project, branch, commit
    
    if project is None or commit is None:
        print >> sys.stderr, "cannot find --project or --commit argument"
        sys.exit(2)

    if project != 'gfs':
        return

    script = "/home/root1/autobuilder/start"
    command = "nohup /bin/bash -l -c \"%s %s %s > autobuilder.out 2> autobuilder.err < /dev/null &\"" % \
              (script, "review sha1", commit)
    subprocess.call(["ssh", 'root@10.10.200.116', command])


if __name__ == '__main__':
    main()
